<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Th√†nh Vi√™n</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<!-- Menu v·ªõi Bootstrap -->
<div th:replace="~{Brower/navBar:: navbar}"></div>

<div class="container mt-4" style="max-width: 600px;"> <!-- Gi·ªõi h·∫°n ƒë·ªô r·ªông n·ªôi dung -->
    <!-- Tabs cho ƒêƒÉng nh·∫≠p v√† ƒêƒÉng k√Ω -->
    <ul class="nav nav-tabs">
        <li class="nav-item w-50 text-center">
            <a class="nav-link active" data-toggle="tab" href="#login">ƒêƒÉng nh·∫≠p</a>
        </li>
        <li class="nav-item w-50 text-center">
            <a class="nav-link" data-toggle="tab" href="#register">ƒêƒÉng k√Ω</a>
        </li>
    </ul>

    <!-- N·ªôi dung Tab -->
    <div class="tab-content mt-4 mb-4"> <!-- Th√™m kho·∫£ng c√°ch d∆∞·ªõi -->
        <!-- Tab ƒêƒÉng nh·∫≠p -->
        <div id="login" class="tab-pane fade show active">
            <h3 class="text-center">ƒêƒÉng nh·∫≠p</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email" placeholder="Nh·∫≠p email">
                </div>
                <div class="form-group">
                    <label for="password">M·∫≠t kh·∫©u:</label>
                    <input type="password" class="form-control" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <div id="errorMessage" class="text-danger mt-2" style="display: none;"></div>
                <button type="button" class="btn btn-primary btn-block" id="loginButton">ƒêƒÉng nh·∫≠p</button>
            </form>
        </div>
    <!-- Tab ƒêƒÉng k√Ω -->
    <div id="register" class="tab-pane fade">
        <h3 class="text-center">ƒêƒÉng k√Ω</h3>
        <form>
            <!-- H·ªç v√† t√™n -->
            <div class="form-group">
                <label for="name">H·ªç v√† t√™n: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üë§</span>
                    </div>
                    <input type="text" class="form-control" id="name" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                </div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="email-register">Email: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üìß</span>
                    </div>
                    <input type="email" class="form-control" id="email-register" placeholder="Nh·∫≠p email">
                </div>
            </div>

            <!-- M·∫≠t kh·∫©u -->
            <div class="form-group">
                <label for="password-register">M·∫≠t kh·∫©u: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üîí</span>
                    </div>
                    <input type="password" class="form-control" id="password-register" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
            </div>

            <!-- X√°c nh·∫≠n m·∫≠t kh·∫©u -->
            <div class="form-group">
                <label for="confirm-password">X√°c nh·∫≠n m·∫≠t kh·∫©u: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üîí</span>
                    </div>
                    <input type="password" class="form-control" id="confirm-password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
                </div>
            </div>

            <!-- Ng√†y sinh -->
            <div class="form-group">
                <label for="birthdate">Ng√†y sinh: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üìÖ</span>
                    </div>
                    <input type="date" class="form-control" id="birthdate">
                </div>
            </div>

            <!-- Gi·ªõi t√≠nh -->
            <div class="form-group">
                <label for="gender">Gi·ªõi t√≠nh:</label>
                <select id="gender" class="form-control">
                    <option value="male">Nam</option>
                    <option value="female">N·ªØ</option>
                    <option value="other">Kh√°c</option>
                </select>
            </div>

            <!-- S·ªë ƒëi·ªán tho·∫°i -->
            <div class="form-group">
                <label for="phone">S·ªë ƒëi·ªán tho·∫°i: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üìû</span>
                    </div>
                    <input type="tel" class="form-control" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                </div>
            </div>

            <!-- M√£ x√°c th·ª±c -->
            <div class="form-group">
                <label for="captcha">M√£ x√°c th·ª±c: <span style="color: red;">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">üî¢</span>
                    </div>
                    <input type="text" class="form-control" id="captcha" placeholder="Nh·∫≠p m√£ x√°c th·ª±c">
                    <div class="input-group-append">
                        <span id="maN" class="input-group-text">1234AB</span> <!-- M√£ x√°c th·ª±c ng·∫´u nhi√™n -->
                    </div>
                </div>
            </div>

            <!-- Checkbox ƒëi·ªÅu kho·∫£n -->
            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="terms">
                <label class="form-check-label" for="terms">
                    T√¥i cam k·∫øt tu√¢n theo <a href="#">ch√≠nh s√°ch b·∫£o m·∫≠t</a> v√† <a href="#">ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>.
                </label>
            </div>

            <!-- N√∫t ƒêƒÉng k√Ω -->
            <button type="submit" class="btn btn-success btn-block">ƒêƒÉng k√Ω</button>
        </form>
    </div>
</div>
    </div>

<!-- Footer -->
<div class="mt-5"> <!-- T·∫°o kho·∫£ng c√°ch l·ªõn gi·ªØa n·ªôi dung v√† footer -->
    <div th:replace="~{Brower/footer::footer}"></div>
</div>

<script th:src="@{/assets/js/browerJS/menuLocation.js}"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const roomId =  urlParams.get('roomId');
    const movieId = urlParams.get('movieId');
    const showtimeId = urlParams.get('showtimeId');
    const cinemaId = urlParams.get('cinemaId');

    document.getElementById('loginButton').addEventListener('click', async function () {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const errorMessage = document.getElementById('errorMessage');

        // Ki·ªÉm tra th√¥ng tin ƒë·∫ßu v√†o
        if (!email || !password) {
            errorMessage.style.display = 'block';
            errorMessage.textContent = 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.';
            return;
        }

        try {
            // G·ª≠i y√™u c·∫ßu t·ªõi API ƒëƒÉng nh·∫≠p
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });

            if (response.ok) {
                const data = await response.json();

                const userId = data.userId;
                const email = data.email;

                sessionStorage.setItem('userId', userId); // Ho·∫∑c localStorage.setItem('userId', userId);
                sessionStorage.setItem('email', email);  // L∆∞u email ng∆∞·ªùi d√πng

                if (roomId && movieId && showtimeId && cinemaId) {
                    window.location.href = `/chonGhe.htm?roomId=${roomId}&movieId=${movieId}&showtimeId=${showtimeId}&cinemaId=${cinemaId}&userId=${userId}`;
                    return;
                }
                // N·∫øu ƒëƒÉng nh·∫≠p th√†nh c√¥ng, chuy·ªÉn h∆∞·ªõng t·ªõi trang home
                window.location.href = `/home.htm?userId=${userId}`; // Chuy·ªÉn h∆∞·ªõng v·ªõi userId
            } else {
                // N·∫øu th·∫•t b·∫°i, hi·ªÉn th·ªã l·ªói
                const errorData = await response.json();
                errorMessage.style.display = 'block';
                errorMessage.textContent = errorData.message || 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.';
            }
        } catch (error) {
            console.error('L·ªói ƒëƒÉng nh·∫≠p:', error);
            errorMessage.style.display = 'block';
            errorMessage.textContent = 'ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i sau.';
        }
    });
</script>
<script th:src="@{/assets/js/browerJS/register.js}"></script>
</body>
</html>
